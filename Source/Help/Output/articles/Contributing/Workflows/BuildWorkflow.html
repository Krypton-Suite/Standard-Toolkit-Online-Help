<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Build Workflow | Krypton Standard Toolkit Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Build Workflow | Krypton Standard Toolkit Documentation ">
    
    
      <link rel="shortcut icon" href="../../../Krypton.ico">
      <link rel="stylesheet" href="../../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../../styles/docfx.css">
      <link rel="stylesheet" href="../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../toc.html">
      <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../Logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="build-workflow">Build Workflow</h1>

<h2 id="overview">Overview</h2>
<p>The Build workflow provides continuous integration (CI) for the Krypton Standard Toolkit. It validates code changes by building the solution on pull requests and pushes to main branches, ensuring build integrity before code is merged or released.</p>
<h2 id="purpose">Purpose</h2>
<ul>
<li><strong>CI Validation</strong>: Ensures all changes compile successfully</li>
<li><strong>Multi-Target Framework Support</strong>: Builds for multiple .NET versions</li>
<li><strong>Pre-Release Validation</strong>: Validates builds before they reach release workflows</li>
<li><strong>Security</strong>: Only builds PRs from the same repository (prevents fork-based attacks)</li>
</ul>
<h2 id="trigger-conditions">Trigger Conditions</h2>
<h3 id="pull-requests">Pull Requests</h3>
<ul>
<li><strong>Branches</strong>: All branches (<code>**</code>)</li>
<li><strong>Types</strong>: <code>opened</code>, <code>synchronize</code>, <code>reopened</code>
<ul>
<li>Runs when PR is created, updated, or reopened</li>
</ul>
</li>
</ul>
<h3 id="pushes">Pushes</h3>
<ul>
<li><strong>Branches</strong>:
<ul>
<li><code>master</code></li>
<li><code>alpha</code></li>
<li><code>canary</code></li>
<li><code>gold</code></li>
<li><code>V105-LTS</code></li>
<li><code>V85-LTS</code></li>
</ul>
</li>
<li><strong>Path Filters</strong>: Ignores changes to <code>.git*</code> and <code>.vscode</code> directories</li>
</ul>
<h3 id="security-filter">Security Filter</h3>
<p>The build job includes a security check:</p>
<pre><code class="lang-yaml">if: github.event_name != 'pull_request' || github.event.pull_request.head.repo.full_name == github.repository
</code></pre>
<p>This ensures:</p>
<ul>
<li>All pushes are built</li>
<li>Only PRs from the same repository are built (not forks)</li>
</ul>
<h2 id="workflow-structure">Workflow Structure</h2>
<h3 id="job-1-build">Job 1: <code>build</code></h3>
<p><strong>Runner</strong>: <code>windows-latest</code></p>
<p><strong>Purpose</strong>: Builds the solution to validate changes</p>
<p><strong>Steps</strong>:</p>
<ol>
<li><p><strong>Checkout</strong></p>
<ul>
<li>Uses <code>actions/checkout@v6</code></li>
<li>Checks out the source code</li>
</ul>
</li>
<li><p><strong>Setup .NET</strong></p>
<ul>
<li>Uses <code>actions/setup-dotnet@v5</code></li>
<li>Installs .NET 9.0.x and 10.0.x SDKs</li>
<li>Required for building multi-target projects</li>
</ul>
</li>
<li><p><strong>Force .NET 10 SDK via global.json</strong></p>
<ul>
<li>Dynamically generates <code>global.json</code> to pin SDK version</li>
<li>Uses PowerShell to detect installed .NET 10 SDK</li>
<li>Sets <code>rollForward: latestFeature</code> for compatibility</li>
</ul>
</li>
<li><p><strong>Setup MSBuild</strong></p>
<ul>
<li>Uses <code>microsoft/setup-msbuild@v2</code></li>
<li>Configures MSBuild with x64 architecture</li>
<li>Required for building .NET Framework targets</li>
</ul>
</li>
<li><p><strong>Setup NuGet</strong></p>
<ul>
<li>Uses <code>NuGet/setup-nuget@v2.0.1</code></li>
<li>Configures NuGet for package restoration</li>
</ul>
</li>
<li><p><strong>Cache NuGet</strong></p>
<ul>
<li>Uses <code>actions/cache@v4</code></li>
<li>Caches <code>~/.nuget/packages</code> directory</li>
<li>Cache key based on project file hashes</li>
<li>Speeds up subsequent builds</li>
</ul>
</li>
<li><p><strong>Restore</strong></p>
<ul>
<li>Restores NuGet packages for the solution</li>
<li>Solution: <code>Source/Krypton Components/Krypton Toolkit Suite 2022 - VS2022.sln</code></li>
</ul>
</li>
<li><p><strong>Build</strong></p>
<ul>
<li>Builds using MSBuild with <code>nightly.proj</code></li>
<li>Configuration: <code>Release</code></li>
<li>Platform: <code>Any CPU</code></li>
<li>Target: <code>Rebuild</code> (clean and build)</li>
</ul>
</li>
</ol>
<h3 id="job-2-release">Job 2: <code>release</code></h3>
<p><strong>Runner</strong>: <code>windows-latest</code></p>
<p><strong>Condition</strong>: Only runs on <code>master</code> branch pushes</p>
<p><strong>Purpose</strong>: Prepares release artifacts (builds and packages)</p>
<p><strong>Dependencies</strong>: Requires <code>build</code> job to complete successfully</p>
<p><strong>Steps</strong>:</p>
<ol>
<li><p><strong>Checkout</strong> - Same as build job</p>
</li>
<li><p><strong>Setup .NET</strong> - Same as build job</p>
</li>
<li><p><strong>Force .NET 10 SDK via global.json</strong> - Same as build job</p>
</li>
<li><p><strong>Setup MSBuild</strong> - Same as build job</p>
</li>
<li><p><strong>Setup NuGet</strong> - Same as build job</p>
</li>
<li><p><strong>Cache NuGet</strong> - Same as build job</p>
</li>
<li><p><strong>Restore</strong> - Same as build job</p>
</li>
<li><p><strong>Build Release</strong></p>
<ul>
<li>Uses <code>Scripts/build.proj</code> instead of <code>nightly.proj</code></li>
<li>Configuration: <code>Release</code></li>
<li>Platform: <code>Any CPU</code></li>
<li>Target: <code>Build</code></li>
</ul>
</li>
<li><p><strong>Pack Release</strong></p>
<ul>
<li>Uses <code>Scripts/build.proj</code></li>
<li>Configuration: <code>Release</code></li>
<li>Platform: <code>Any CPU</code></li>
<li>Target: <code>Pack</code></li>
<li>Creates NuGet packages in <code>Bin/Packages/Release/</code></li>
</ul>
</li>
<li><p><strong>Get Version</strong></p>
<ul>
<li>Extracts version from built assembly or project file</li>
<li>Sets output variables: <code>version</code> and <code>tag</code></li>
<li>Fallback version: <code>100.25.1.1</code> if extraction fails</li>
</ul>
</li>
</ol>
<h2 id="detailed-behavior">Detailed Behavior</h2>
<h3 id="net-sdk-management">.NET SDK Management</h3>
<p>The workflow uses a dynamic <code>global.json</code> approach:</p>
<pre><code class="lang-powershell">$sdkVersion = (dotnet --list-sdks | Select-String &quot;10.0&quot;).ToString().Split(&quot; &quot;)[0]
</code></pre>
<p><strong>Benefits</strong>:</p>
<ul>
<li>Automatically uses the latest installed .NET 10 SDK</li>
<li>Handles version variations across GitHub runners</li>
<li>Ensures consistent SDK usage</li>
</ul>
<h3 id="build-projects">Build Projects</h3>
<p><strong>Build Job</strong>:</p>
<ul>
<li>Uses <code>Scripts/nightly.proj</code></li>
<li>Rebuilds everything from scratch</li>
<li>Validates full build process</li>
</ul>
<p><strong>Release Job</strong>:</p>
<ul>
<li>Uses <code>Scripts/build.proj</code></li>
<li>Standard release build configuration</li>
<li>Creates packages for distribution</li>
</ul>
<h3 id="nuget-caching">NuGet Caching</h3>
<p><strong>Cache Strategy</strong>:</p>
<ul>
<li><strong>Key</strong>: <code>${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}</code></li>
<li><strong>Path</strong>: <code>~/.nuget/packages</code></li>
<li><strong>Restore Keys</strong>: Falls back to partial match if exact key not found</li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul>
<li>Faster builds by reusing packages</li>
<li>Reduces network traffic</li>
<li>Speeds up CI pipeline</li>
</ul>
<h3 id="version-extraction">Version Extraction</h3>
<p>The release job attempts multiple methods to extract version:</p>
<ol>
<li><p><strong>Assembly Version</strong> (Primary)</p>
<ul>
<li>Reads version from built DLL</li>
<li>Most reliable method</li>
</ul>
</li>
<li><p><strong>Project File</strong> (Fallback)</p>
<ul>
<li>Parses XML from <code>.csproj</code> file</li>
<li>Extracts <code>&lt;Version&gt;</code> element</li>
</ul>
</li>
<li><p><strong>Hardcoded Fallback</strong></p>
<ul>
<li>Uses <code>100.25.1.1</code> if all methods fail</li>
<li>Ensures workflow doesn't fail due to version issues</li>
</ul>
</li>
</ol>
<h2 id="build-artifacts">Build Artifacts</h2>
<h3 id="build-job-outputs">Build Job Outputs</h3>
<ul>
<li>Compiled assemblies in <code>Bin/Release/</code> or <code>Bin/Nightly/</code></li>
<li>Organized by target framework (e.g., <code>net48</code>, <code>net8.0-windows</code>)</li>
</ul>
<h3 id="release-job-outputs">Release Job Outputs</h3>
<ul>
<li>NuGet packages in <code>Bin/Packages/Release/</code></li>
<li>Version information in job outputs</li>
</ul>
<h2 id="target-frameworks">Target Frameworks</h2>
<p>The solution builds for multiple target frameworks:</p>
<ul>
<li><strong>.NET Framework</strong>: 4.7.2, 4.8, 4.8.1</li>
<li><strong>.NET</strong>: 8.0, 9.0, 10.0 (Windows-specific)</li>
</ul>
<p>All frameworks are built in a single workflow run.</p>
<h2 id="configuration">Configuration</h2>
<h3 id="no-secrets-required">No Secrets Required</h3>
<p>The build workflow doesn't require any secrets. It only validates builds and doesn't publish packages.</p>
<h3 id="required-tools">Required Tools</h3>
<ul>
<li>.NET 9.0.x and 10.0.x SDKs (installed by workflow)</li>
<li>MSBuild (installed by workflow)</li>
<li>NuGet (installed by workflow)</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="build-failures">Build Failures</h3>
<p><strong>Common Causes</strong>:</p>
<ol>
<li><strong>Compilation Errors</strong>: Check code for syntax or type errors</li>
<li><strong>Missing Dependencies</strong>: Verify all NuGet packages restore correctly</li>
<li><strong>SDK Version Issues</strong>: Check <code>global.json</code> generation in logs</li>
<li><strong>MSBuild Errors</strong>: Review build logs for specific errors</li>
</ol>
<p><strong>Solutions</strong>:</p>
<ul>
<li>Review build logs in Actions tab</li>
<li>Test builds locally with same SDK versions</li>
<li>Check for breaking changes in dependencies</li>
<li>Verify project file configurations</li>
</ul>
<h3 id="nuget-restore-failures">NuGet Restore Failures</h3>
<p><strong>Possible Causes</strong>:</p>
<ol>
<li>Network issues</li>
<li>Package source unavailable</li>
<li>Invalid package references</li>
<li>Cache corruption</li>
</ol>
<p><strong>Solutions</strong>:</p>
<ul>
<li>Check NuGet package sources</li>
<li>Clear cache and retry</li>
<li>Verify package versions exist</li>
<li>Review <code>nuget.config</code> if present</li>
</ul>
<h3 id="version-extraction-failures">Version Extraction Failures</h3>
<p><strong>Behavior</strong>: Workflow continues with fallback version</p>
<p><strong>Solutions</strong>:</p>
<ul>
<li>Check if assembly was built successfully</li>
<li>Verify project file has <code>&lt;Version&gt;</code> element</li>
<li>Review version extraction script in logs</li>
</ul>
<h3 id="pr-from-fork-not-building">PR from Fork Not Building</h3>
<p><strong>Expected Behavior</strong>: This is a security feature</p>
<p><strong>Reason</strong>: Prevents potential security risks from untrusted code</p>
<p><strong>Solution</strong>: Fork PRs should be merged via a branch in the main repository</p>
<h2 id="related-workflows">Related Workflows</h2>
<ul>
<li><strong>Release Workflow</strong>: Uses similar build process for publishing</li>
<li><strong>Nightly Workflow</strong>: Uses <code>nightly.proj</code> for scheduled builds</li>
</ul>
<h2 id="code-reference">Code Reference</h2>
<p><strong>File</strong>: <code>.github/workflows/build.yml</code></p>
<p><strong>Key Components</strong>:</p>
<ul>
<li>Event: <code>pull_request</code> and <code>push</code></li>
<li>Jobs: <code>build</code> and <code>release</code></li>
<li>Build Tools: MSBuild, .NET SDK, NuGet</li>
</ul>
<h2 id="maintenance-notes">Maintenance Notes</h2>
<h3 id="updating-net-versions">Updating .NET Versions</h3>
<p>To add support for new .NET versions:</p>
<ol>
<li><p>Add version to <code>Setup .NET</code> step:</p>
<pre><code class="lang-yaml">dotnet-version: |
  9.0.x
  10.0.x
  11.0.x  # New version
</code></pre>
</li>
<li><p>Update <code>global.json</code> generation if needed</p>
</li>
<li><p>Test with sample PR</p>
</li>
</ol>
<h3 id="modifying-build-projects">Modifying Build Projects</h3>
<p>If build project files change:</p>
<ol>
<li>Update paths in workflow steps</li>
<li>Verify target names (<code>Build</code>, <code>Pack</code>, <code>Rebuild</code>)</li>
<li>Test configuration changes</li>
</ol>
<h3 id="cache-invalidation">Cache Invalidation</h3>
<p>To force cache refresh:</p>
<ul>
<li>Modify a <code>.csproj</code> file (changes hash)</li>
<li>Or manually clear cache in Actions settings</li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Keep Builds Fast</strong>: Leverage caching and parallel builds</li>
<li><strong>Fail Fast</strong>: Build should fail on any compilation error</li>
<li><strong>Consistent Environments</strong>: Use same SDK versions as local development</li>
<li><strong>Clear Logs</strong>: Ensure build output is readable and actionable</li>
</ol>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Krypton Component Suite 2024
BSD 3-Clause License
Â© Component Factory Pty Ltd, 2006 - 2016, All rights reserved.</span> <span>Modifications by Peter Wagner (aka Wagnerp), Simon Coghlan (aka Smurf-IV), Giduac, Tobitege, Lesarndro, KamaniAR & Ahmed Abdelhameed et al. 2017 - 2025. All rights reserved. <a href="https://github.com/Krypton-Suite">https://github.com/Krypton-Suite</a></span>
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
