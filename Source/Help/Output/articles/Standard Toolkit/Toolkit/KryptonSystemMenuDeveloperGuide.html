<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>KryptonSystemMenu | Krypton Standard Toolkit Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="KryptonSystemMenu | Krypton Standard Toolkit Documentation ">
    
    
      <link rel="shortcut icon" href="../../../Krypton.ico">
      <link rel="stylesheet" href="../../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../../styles/docfx.css">
      <link rel="stylesheet" href="../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../toc.html">
      <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../Logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="kryptonsystemmenu"><code>KryptonSystemMenu</code></h1>

<h2 id="overview">Overview</h2>
<p>The <code>KryptonSystemMenu</code> class provides a themed system menu that replaces the native Windows system menu with a <code>KryptonContextMenu</code>. This allows for consistent theming and enhanced functionality while maintaining compatibility with standard Windows system menu behavior.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#features">Features</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#theming-and-icons">Theming and Icons</a></li>
<li><a href="#event-handling">Event Handling</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#complete-features-reference">Complete Features Reference</a></li>
</ol>
<h2 id="complete-features-reference">Complete Features Reference</h2>
<p>For comprehensive information about all features, implementation details, and advanced capabilities, see the <a href="KryptonSystemMenuFeaturesReference.html">KryptonSystemMenu Complete Features Reference</a> document.</p>
<h2 id="features">Features</h2>
<h3 id="core-functionality">Core Functionality</h3>
<ul>
<li><strong>Themed System Menu</strong>: Complete replacement of native Windows system menu with Krypton-themed context menu</li>
<li><strong>Standard Menu Items</strong>: Full support for Restore, Move, Size, Minimize, Maximize, and Close operations</li>
<li><strong>Dynamic State Management</strong>: Intelligent enable/disable logic based on form state and properties</li>
<li><strong>Keyboard Shortcuts</strong>: Native-like support for Alt+F4 (Close) and Alt+Space (Show menu)</li>
<li><strong>Icon Integration</strong>: Comprehensive themed icon system with automatic adaptation</li>
</ul>
<h3 id="advanced-features">Advanced Features</h3>
<ul>
<li><strong>Multi-Theme Icon Support</strong>: 8 supported themes (Office 2013, 2010, 2007, Sparkle, Professional, Microsoft 365, Office 2003, Material)</li>
<li><strong>Fallback Icon Generation</strong>: Custom-drawn icons when theme-specific resources are unavailable</li>
<li><strong>Smart Positioning</strong>: Intelligent menu positioning with screen bounds awareness</li>
<li><strong>Form State Integration</strong>: Deep integration with form properties (MinimizeBox, MaximizeBox, ControlBox, FormBorderStyle)</li>
<li><strong>Performance Optimization</strong>: Efficient resource management with direct field references</li>
<li><strong>Error Handling</strong>: Comprehensive exception handling with graceful degradation</li>
<li><strong>Resource Management</strong>: Proper disposal patterns and memory management</li>
</ul>
<h3 id="technical-features">Technical Features</h3>
<ul>
<li><strong>Palette Integration</strong>: Automatic theme detection based on form palette colors</li>
<li><strong>Multi-Screen Support</strong>: Screen-aware positioning for multi-monitor setups</li>
<li><strong>State Synchronization</strong>: Real-time synchronization with form state changes</li>
<li><strong>Icon Caching</strong>: Performance-optimized icon loading and caching</li>
<li><strong>Custom Drawing</strong>: Fallback icon generation with theme-appropriate colors</li>
<li><strong>Event Handling</strong>: Complete event system for menu interactions</li>
<li><strong>Thread Safety</strong>: UI-thread-safe implementation with proper disposal patterns</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="class-hierarchy">Class Hierarchy</h3>
<pre><code class="lang-cs">KryptonSystemMenu : IKryptonSystemMenu, IDisposable
</code></pre>
<h3 id="key-components">Key Components</h3>
<ul>
<li><strong>KryptonContextMenu</strong>: The underlying menu container</li>
<li><strong>Menu Item References</strong>: Direct field references for efficient state management</li>
<li><strong>Icon Management System</strong>: Handles theme-specific icon loading and fallback generation</li>
<li><strong>State Management</strong>: Updates menu item states based on form properties</li>
</ul>
<h3 id="dependencies">Dependencies</h3>
<ul>
<li><code>KryptonForm</code>: Required form type for integration</li>
<li><code>KryptonContextMenu</code>: Core menu functionality</li>
<li><code>SystemMenuImageResources</code>: Icon resources for different themes</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code class="lang-csharp">// Create a KryptonSystemMenu instance
var systemMenu = new KryptonSystemMenu(kryptonForm);

// Show the menu at a specific location
systemMenu.Show(new Point(100, 100));

// Show the menu at the form's top-left corner (like native system menu)
systemMenu.ShowAtFormTopLeft();

// Refresh the menu to update states
systemMenu.Refresh();
</code></pre>
<h3 id="integration-with-kryptonform">Integration with KryptonForm</h3>
<p>The <code>KryptonSystemMenu</code> is typically integrated through the <code>KryptonForm.KryptonSystemMenu</code> property:</p>
<pre><code class="lang-csharp">// Access the system menu from a KryptonForm
var systemMenu = myKryptonForm.KryptonSystemMenu;

if (systemMenu != null)
{
    // Custom menu items are not supported in this version
    systemMenu.Refresh();
}
</code></pre>
<h2 id="api-reference">API Reference</h2>
<h3 id="public-properties">Public Properties</h3>
<h4 id="contextmenu"><code>ContextMenu</code></h4>
<pre><code class="lang-csharp">public KryptonContextMenu ContextMenu { get; }
</code></pre>
<p>Gets the underlying themed context menu. This property is read-only and provides access to the menu for advanced customization.</p>
<h4 id="enabled"><code>Enabled</code></h4>
<pre><code class="lang-csharp">public bool Enabled { get; set; }
</code></pre>
<p>Gets or sets whether the themed system menu is enabled. When disabled, the menu will not respond to show requests.</p>
<h4 id="menuitemcount"><code>MenuItemCount</code></h4>
<pre><code class="lang-csharp">public int MenuItemCount { get; }
</code></pre>
<p>Gets the number of items currently in the themed system menu.</p>
<h4 id="hasmenuitems"><code>HasMenuItems</code></h4>
<pre><code class="lang-csharp">public bool HasMenuItems { get; }
</code></pre>
<p>Gets whether the themed system menu contains any items.</p>
<h4 id="showonleftclick"><code>ShowOnLeftClick</code></h4>
<pre><code class="lang-csharp">public bool ShowOnLeftClick { get; set; }
</code></pre>
<p>Gets or sets whether left-click on title bar shows the themed system menu.</p>
<h4 id="showonrightclick"><code>ShowOnRightClick</code></h4>
<pre><code class="lang-csharp">public bool ShowOnRightClick { get; set; }
</code></pre>
<p>Gets or sets whether right-click on title bar shows the themed system menu.</p>
<h4 id="showonaltspace"><code>ShowOnAltSpace</code></h4>
<pre><code class="lang-csharp">public bool ShowOnAltSpace { get; set; }
</code></pre>
<p>Gets or sets whether Alt+Space shows the themed system menu.</p>
<h4 id="currenticontheme"><code>CurrentIconTheme</code></h4>
<pre><code class="lang-csharp">public string CurrentIconTheme { get; }
</code></pre>
<p>Gets the current theme name being used for system menu icons.</p>
<h3 id="public-methods">Public Methods</h3>
<h4 id="showpoint-screenlocation"><code>Show(Point screenLocation)</code></h4>
<pre><code class="lang-csharp">public void Show(Point screenLocation)
</code></pre>
<p>Shows the themed system menu at the specified screen location. The position is automatically adjusted to ensure the menu stays within screen bounds.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>screenLocation</code>: The screen coordinates where to show the menu.</li>
</ul>
<h4 id="showatformtopleft"><code>ShowAtFormTopLeft()</code></h4>
<pre><code class="lang-csharp">public void ShowAtFormTopLeft()
</code></pre>
<p>Shows the themed system menu at the top-left corner of the form, mimicking the native system menu behavior.</p>
<h4 id="refresh"><code>Refresh()</code></h4>
<pre><code class="lang-csharp">public void Refresh()
</code></pre>
<p>Refreshes the system menu items based on current form state. This method:</p>
<ul>
<li>Rebuilds the menu structure</li>
<li>Updates menu item states (enabled/disabled)</li>
<li>Refreshes icons to match current theme</li>
</ul>
<h4 id="handlekeyboardshortcutkeys-keydata"><code>HandleKeyboardShortcut(Keys keyData)</code></h4>
<pre><code class="lang-csharp">public bool HandleKeyboardShortcut(Keys keyData)
</code></pre>
<p>Handles keyboard shortcuts for system menu actions.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>keyData</code>: The key combination pressed.</li>
</ul>
<p><strong>Returns:</strong> <code>true</code> if the shortcut was handled; otherwise <code>false</code>.</p>
<p><strong>Supported Shortcuts:</strong></p>
<ul>
<li><code>Alt+F4</code>: Close the form</li>
<li><code>Alt+Space</code>: Show the system menu (if enabled)</li>
</ul>
<h4 id="getcurrenttheme"><code>GetCurrentTheme()</code></h4>
<pre><code class="lang-csharp">public string GetCurrentTheme()
</code></pre>
<p>Determines the current theme based on the form's palette.</p>
<p><strong>Returns:</strong> The current theme name.</p>
<h4 id="refreshthemeicons"><code>RefreshThemeIcons()</code></h4>
<pre><code class="lang-csharp">public void RefreshThemeIcons()
</code></pre>
<p>Manually refreshes all icons to match the current theme. Call this method when the application theme changes.</p>
<h4 id="seticonthemestring-themename"><code>SetIconTheme(string themeName)</code></h4>
<pre><code class="lang-csharp">public void SetIconTheme(string themeName)
</code></pre>
<p>Manually sets the theme for icon selection.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>themeName</code>: The theme name to use for icons.</li>
</ul>
<h4 id="setthemetypethemetype-themetype"><code>SetThemeType(ThemeType themeType)</code></h4>
<pre><code class="lang-csharp">public void SetThemeType(ThemeType themeType)
</code></pre>
<p>Sets the theme based on specific theme types.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>themeType</code>: The theme type to use (Black, Blue, Silver, etc.).</li>
</ul>
<h3 id="constructor">Constructor</h3>
<h4 id="kryptonsystemmenukryptonform-form"><code>KryptonSystemMenu(KryptonForm form)</code></h4>
<pre><code class="lang-csharp">public KryptonSystemMenu(KryptonForm form)
</code></pre>
<p>Initializes a new instance of the KryptonSystemMenu class.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>form</code>: The KryptonForm to attach the themed system menu to.</li>
</ul>
<p><strong>Exceptions:</strong></p>
<ul>
<li><code>ArgumentNullException</code>: Thrown when <code>form</code> is null.</li>
</ul>
<h2 id="theming-and-icons">Theming and Icons</h2>
<h3 id="supported-themes">Supported Themes</h3>
<p>The <code>KryptonSystemMenu</code> supports 7 comprehensive themes for icons, each with distinct visual characteristics:</p>
<table>
<thead>
<tr>
<th>Theme</th>
<th>Description</th>
<th>Visual Style</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Office 2013</strong></td>
<td>Default modern theme</td>
<td>Clean, flat design with minimal details</td>
<td>Modern applications, default choice</td>
</tr>
<tr>
<td><strong>Office 2010</strong></td>
<td>Classic Office 2010</td>
<td>Traditional Windows style with subtle gradients</td>
<td>Business applications, classic look</td>
</tr>
<tr>
<td><strong>Office 2007</strong></td>
<td>Office 2007 style</td>
<td>Ribbon-era design with moderate styling</td>
<td>Legacy compatibility, ribbon applications</td>
</tr>
<tr>
<td><strong>Sparkle</strong></td>
<td>Vibrant theme</td>
<td>Bright, colorful with high contrast</td>
<td>Creative applications, eye-catching design</td>
</tr>
<tr>
<td><strong>Professional</strong></td>
<td>Neutral theme</td>
<td>Business-appropriate, conservative styling</td>
<td>Enterprise applications, professional look</td>
</tr>
<tr>
<td><strong>Microsoft 365</strong></td>
<td>Modern Microsoft 365</td>
<td>Contemporary design with balanced colors</td>
<td>Cloud applications, modern interfaces</td>
</tr>
<tr>
<td><strong>Office 2003</strong></td>
<td>Classic Office 2003</td>
<td>Legacy Windows style with traditional appearance</td>
<td>Legacy applications, classic Windows look</td>
</tr>
</tbody>
</table>
<h3 id="icon-types">Icon Types</h3>
<p>The system supports comprehensive icon types with intelligent fallback mechanisms:</p>
<table>
<thead>
<tr>
<th>Icon Type</th>
<th>Description</th>
<th>Visual Representation</th>
<th>Theme Support</th>
<th>Fallback</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Restore</strong></td>
<td>Restore window to normal size</td>
<td>Square with overlapping arrow</td>
<td>✅ All themes</td>
<td>✅ Custom drawn</td>
</tr>
<tr>
<td><strong>Minimize</strong></td>
<td>Minimize window to taskbar</td>
<td>Horizontal line (underscore)</td>
<td>✅ All themes</td>
<td>✅ Custom drawn</td>
</tr>
<tr>
<td><strong>Maximize</strong></td>
<td>Maximize window to full screen</td>
<td>Square outline</td>
<td>✅ All themes</td>
<td>✅ Custom drawn</td>
</tr>
<tr>
<td><strong>Close</strong></td>
<td>Close the window</td>
<td>X symbol</td>
<td>✅ All themes</td>
<td>✅ Custom drawn</td>
</tr>
<tr>
<td><strong>Move</strong></td>
<td>Allow window dragging</td>
<td>Text only (no icon)</td>
<td>❌ N/A</td>
<td>❌ N/A</td>
</tr>
<tr>
<td><strong>Size</strong></td>
<td>Allow window resizing</td>
<td>Text only (no icon)</td>
<td>❌ N/A</td>
<td>❌ N/A</td>
</tr>
</tbody>
</table>
<h3 id="icon-characteristics">Icon Characteristics</h3>
<ul>
<li><strong>Size</strong>: Standard 16x16 pixel icons</li>
<li><strong>Format</strong>: 32-bit ARGB with proper transparency support</li>
<li><strong>Anti-aliasing</strong>: Smooth rendering with anti-aliasing enabled</li>
<li><strong>Color Adaptation</strong>: Icons automatically adapt to current theme colors</li>
<li><strong>Transparency</strong>: Full alpha channel support for seamless integration</li>
</ul>
<h3 id="theme-detection">Theme Detection</h3>
<p>The system automatically detects the current theme based on the form's palette:</p>
<pre><code class="lang-csharp">// Theme detection logic
var palette = _form.GetResolvedPalette();
var headerColor = palette.GetBackColor1(PaletteBackStyle.HeaderForm, PaletteState.Normal);

// Theme selection based on color characteristics
return headerColor switch
{
    var color when IsLightColor(color) =&gt; &quot;Office2013&quot;,
    var color when IsBlueTone(color) =&gt; &quot;Office2010&quot;,
    var color when IsDarkBlueTone(color) =&gt; &quot;Office2007&quot;,
    var color when IsVibrantColor(color) =&gt; &quot;Sparkle&quot;,
    var color when IsNeutralTone(color) =&gt; &quot;Professional&quot;,
    var color when IsModernColor(color) =&gt; &quot;Microsoft365&quot;,
    var color when IsClassicColor(color) =&gt; &quot;Office2003&quot;,
    _ =&gt; &quot;Office2013&quot; // default fallback
};
</code></pre>
<h3 id="fallback-icon-generation">Fallback Icon Generation</h3>
<p>When theme-specific icons are not available, the system generates custom drawn icons:</p>
<pre><code class="lang-csharp">private Image? GetDrawnIcon(SystemMenuIconType iconType)
{
    const int iconSize = 16;
    var bitmap = new Bitmap(iconSize, iconSize);
    
    using (var graphics = Graphics.FromImage(bitmap))
    {
        graphics.SmoothingMode = SmoothingMode.AntiAlias;
        graphics.Clear(Color.Transparent);
        
        var foregroundColor = GetThemeForegroundColor();
        var backgroundColor = GetThemeBackgroundColor();
        
        switch (iconType)
        {
            case SystemMenuIconType.Restore:
                DrawRestoreIcon(graphics, iconSize, foregroundColor, backgroundColor);
                break;
            // ... other icon types
        }
    }
    
    return bitmap;
}
</code></pre>
<h2 id="event-handling">Event Handling</h2>
<h3 id="menu-item-click-events">Menu Item Click Events</h3>
<p>The system menu handles click events for all standard menu items:</p>
<pre><code class="lang-csharp">// Event handlers are automatically wired up
private void OnRestoreItemOnClick(object? sender, EventArgs e) =&gt; ExecuteRestore();
private void OnMinimizeItemOnClick(object? sender, EventArgs e) =&gt; ExecuteMinimize();
private void OnMaximizeItemOnClick(object? sender, EventArgs e) =&gt; ExecuteMaximize();
private void OnCloseItemOnClick(object? sender, EventArgs e) =&gt; ExecuteClose();
</code></pre>
<h3 id="action-execution">Action Execution</h3>
<p>Each menu item action is executed through dedicated methods:</p>
<pre><code class="lang-csharp">private void ExecuteRestore()
{
    if (_form.WindowState != FormWindowState.Normal)
    {
        _form.WindowState = FormWindowState.Normal;
    }
    else
    {
        SendSysCommand(PI.SC_.RESTORE);
    }
}
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-proper-initialization">1. Proper Initialization</h3>
<p>Always initialize the <code>KryptonSystemMenu</code> with a valid <code>KryptonForm</code>:</p>
<pre><code class="lang-csharp">// Good
var systemMenu = new KryptonSystemMenu(myKryptonForm);

// Bad - will throw ArgumentNullException
var systemMenu = new KryptonSystemMenu(null);
</code></pre>
<h3 id="2-theme-integration">2. Theme Integration</h3>
<p>Call <code>RefreshThemeIcons()</code> when the application theme changes:</p>
<pre><code class="lang-csharp">// When theme changes
kryptonManager.GlobalPalette = newPalette;
systemMenu.RefreshThemeIcons();
</code></pre>
<h3 id="3-state-management">3. State Management</h3>
<p>The system automatically manages menu item states, but you can manually refresh when needed:</p>
<pre><code class="lang-csharp">// Refresh after form state changes
_form.WindowState = FormWindowState.Maximized;
systemMenu.Refresh();
</code></pre>
<h3 id="4-error-handling">4. Error Handling</h3>
<p>The system includes comprehensive error handling, but you should handle disposal properly:</p>
<pre><code class="lang-csharp">using (var systemMenu = new KryptonSystemMenu(form))
{
    // Use the system menu
    systemMenu.ShowAtFormTopLeft();
} // Automatically disposed
</code></pre>
<h3 id="5-performance-considerations">5. Performance Considerations</h3>
<ul>
<li>Menu items are created once and reused</li>
<li>Icons are cached and only regenerated when theme changes</li>
<li>State updates are efficient using direct field references</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<h4 id="menu-not-showing">Menu Not Showing</h4>
<p><strong>Problem</strong>: Menu doesn't appear when called.</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Check if <code>Enabled</code> property is set to <code>true</code></li>
<li>Verify the form has menu items: <code>systemMenu.HasMenuItems</code></li>
<li>Ensure the form is not disposed</li>
</ol>
<pre><code class="lang-csharp">if (systemMenu.Enabled &amp;&amp; systemMenu.HasMenuItems)
{
    systemMenu.ShowAtFormTopLeft();
}
</code></pre>
<h4 id="icons-not-displaying">Icons Not Displaying</h4>
<p><strong>Problem</strong>: Menu items show without icons.</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Check if icon resources are available</li>
<li>Call <code>RefreshThemeIcons()</code> after theme changes</li>
<li>Verify theme detection is working: <code>systemMenu.CurrentIconTheme</code></li>
</ol>
<pre><code class="lang-csharp">// Debug theme detection
var currentTheme = systemMenu.CurrentIconTheme;
Debug.WriteLine($&quot;Current theme: {currentTheme}&quot;);

// Force icon refresh
systemMenu.RefreshThemeIcons();
</code></pre>
<h4 id="menu-items-not-responding">Menu Items Not Responding</h4>
<p><strong>Problem</strong>: Clicking menu items doesn't perform actions.</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Check if the form is in a valid state</li>
<li>Verify form properties (MinimizeBox, MaximizeBox, ControlBox)</li>
<li>Call <code>Refresh()</code> to update menu states</li>
</ol>
<pre><code class="lang-csharp">// Check form state
Debug.WriteLine($&quot;Window State: {_form.WindowState}&quot;);
Debug.WriteLine($&quot;MinimizeBox: {_form.MinimizeBox}&quot;);
Debug.WriteLine($&quot;MaximizeBox: {_form.MaximizeBox}&quot;);

// Refresh menu
systemMenu.Refresh();
</code></pre>
<h3 id="debug-information">Debug Information</h3>
<p>Enable debug output to troubleshoot issues:</p>
<pre><code class="lang-csharp">// The system includes debug output for errors
Debug.WriteLine($&quot;Error building system menu: {ex.Message}&quot;);
</code></pre>
<h2 id="examples">Examples</h2>
<h3 id="example-1-basic-integration">Example 1: Basic Integration</h3>
<pre><code class="lang-csharp">public partial class MainForm : KryptonForm
{
    private KryptonSystemMenu? _systemMenu;

    public MainForm()
    {
        InitializeComponent();
        
        // Initialize system menu
        _systemMenu = new KryptonSystemMenu(this);
    }

    private void MainForm_Load(object sender, EventArgs e)
    {
        // Show system menu on Alt+Space
        if (_systemMenu != null)
        {
            _systemMenu.ShowOnAltSpace = true;
        }
    }

    protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
    {
        // Handle system menu shortcuts
        if (_systemMenu?.HandleKeyboardShortcut(keyData) == true)
        {
            return true;
        }
        
        return base.ProcessCmdKey(ref msg, keyData);
    }

    protected override void Dispose(bool disposing)
    {
        if (disposing)
        {
            _systemMenu?.Dispose();
        }
        base.Dispose(disposing);
    }
}
</code></pre>
<h3 id="example-2-custom-menu-positioning">Example 2: Custom Menu Positioning</h3>
<pre><code class="lang-csharp">private void ShowSystemMenuAtCursor()
{
    if (_systemMenu != null &amp;&amp; _systemMenu.Enabled)
    {
        // Show menu at current cursor position
        var cursorPos = Cursor.Position;
        _systemMenu.Show(cursorPos);
    }
}

private void ShowSystemMenuAtFormCenter()
{
    if (_systemMenu != null &amp;&amp; _systemMenu.Enabled)
    {
        // Calculate form center position
        var formCenter = new Point(
            Location.X + Width / 2,
            Location.Y + Height / 2
        );
        _systemMenu.Show(formCenter);
    }
}
</code></pre>
<h3 id="example-3-theme-integration">Example 3: Theme Integration</h3>
<pre><code class="lang-csharp">private void ChangeTheme(PaletteMode mode)
{
    // Change the global palette
    kryptonManager.GlobalPaletteMode = mode;
    
    // Refresh system menu icons to match new theme
    if (_systemMenu != null)
    {
        _systemMenu.RefreshThemeIcons();
    }
}

private void SetSpecificTheme()
{
    if (_systemMenu != null)
    {
        // Set specific theme type
        _systemMenu.SetThemeType(ThemeType.Office2010Blue);
        
        // Or set specific theme name
        _systemMenu.SetIconTheme(&quot;Sparkle&quot;);
    }
}
</code></pre>
<h3 id="example-4-advanced-state-management">Example 4: Advanced State Management</h3>
<pre><code class="lang-csharp">private void UpdateSystemMenuState()
{
    if (_systemMenu != null)
    {
        // Enable/disable based on custom logic
        _systemMenu.ShowOnLeftClick = AllowLeftClickMenu;
        _systemMenu.ShowOnRightClick = AllowRightClickMenu;
        _systemMenu.ShowOnAltSpace = AllowAltSpaceMenu;
        
        // Refresh to apply changes
        _systemMenu.Refresh();
        
        // Get debug information
        Debug.WriteLine($&quot;Menu enabled: {_systemMenu.Enabled}&quot;);
        Debug.WriteLine($&quot;Menu item count: {_systemMenu.MenuItemCount}&quot;);
        Debug.WriteLine($&quot;Current theme: {_systemMenu.CurrentIconTheme}&quot;);
    }
}
</code></pre>
<h3 id="example-5-event-integration">Example 5: Event Integration</h3>
<pre><code class="lang-csharp">public partial class MainForm : KryptonForm
{
    private KryptonSystemMenu? _systemMenu;

    public MainForm()
    {
        InitializeComponent();
        InitializeSystemMenu();
    }

    private void InitializeSystemMenu()
    {
        _systemMenu = new KryptonSystemMenu(this);
        
        // Hook into form events
        Load += OnFormLoad;
        WindowStateChanged += OnWindowStateChanged;
        Resize += OnFormResize;
    }

    private void OnFormLoad(object? sender, EventArgs e)
    {
        // Initial setup
        _systemMenu?.Refresh();
    }

    private void OnWindowStateChanged(object? sender, EventArgs e)
    {
        // Update menu when window state changes
        _systemMenu?.Refresh();
    }

    private void OnFormResize(object? sender, EventArgs e)
    {
        // Update menu when form is resized
        _systemMenu?.Refresh();
    }
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>The <code>KryptonSystemMenu</code> provides a powerful and flexible way to implement themed system menus in Krypton applications. By following the guidelines and examples in this documentation, developers can effectively integrate and customize the system menu to meet their specific requirements.</p>
<p>For additional support and updates, refer to the main Krypton Toolkit documentation and community resources.</p>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Krypton Component Suite 2024
BSD 3-Clause License
© Component Factory Pty Ltd, 2006 - 2016, All rights reserved.</span> <span>Modifications by Peter Wagner (aka Wagnerp), Simon Coghlan (aka Smurf-IV), Giduac, Tobitege, Lesarndro, KamaniAR & Ahmed Abdelhameed et al. 2017 - 2025. All rights reserved. <a href="https://github.com/Krypton-Suite">https://github.com/Krypton-Suite</a></span>
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
